# Mounting Configuration Explained

## Overview
The mounting configuration is the critical bridge between your external storage device and the Samba file sharing service. Getting this right ensures proper file permissions and seamless access across all devices.

## Why Mounting Matters for NAS

### The Problem
- External drives mount with **root ownership** by default
- Samba users can't write to root-owned directories
- Results in "Access Denied" errors from Windows/mobile devices

### The Solution
Mount the drive with specific **User ID (UID)** and **Group ID (GID)** that match your Samba user.

## Key Concepts

### File System Types
- **NTFS**: Windows native, requires `ntfs-3g` package
- **exFAT**: Cross-platform, good for large files (our choice)
- **ext4**: Linux native, best performance but Windows can't read
- **FAT32**: Universal but 4GB file size limit

### Mount Parameters Explained

| Parameter | Purpose | Example |
|-----------|---------|---------|
| `uid=1001` | Set owner user ID | Files owned by soumyadeep user |
| `gid=1001` | Set owner group ID | Files owned by soumyadeep group |
| `umask=002` | Permission mask | Files get 775 permissions (rwxrwxr-x) |
| `permissions` | Enable permission handling | Required for NTFS |
| `allow_utime` | Allow time modifications | Prevents permission errors |

## Our Final Configuration

### Device Information
- **Device**: `/dev/sda2` (1TB Western Digital external drive)
- **File System**: exFAT (detected via `blkid` command)
- **Mount Point**: `/sonunas`
- **Target User**: `soumyadeep` (UID: 1001, GID: 1001)

### Working Mount Command
```bash
sudo mount -t exfat -o uid=1001,gid=1001,umask=002 /dev/sda2 /sonunas
```

### Why This Works
1. **`-t exfat`**: Specifies the correct file system type
2. **`uid=1001,gid=1001`**: Files are owned by soumyadeep user
3. **`umask=002`**: Creates files with 775 permissions (rwxrwxr-x)
4. **`/dev/sda2`**: The correct partition (not /dev/sda which is the whole disk)
5. **`/sonunas`**: Our designated mount point

## Permission Flow
```
External Drive → Mount with UID 1001 → soumyadeep user owns files → Samba can read/write → Windows/Android access works
```

## Common Mount Issues

### Wrong File System
- **Error**: `NTFS signature is missing`
- **Solution**: Check actual file system with `sudo blkid /dev/sdX2`

### Permission Denied
- **Error**: `cannot touch '/sonunas/test.txt': Permission denied`
- **Solution**: Verify UID/GID matches your Samba user with `id username`

### Device Busy
- **Error**: `umount: /sonunas: target is busy`
- **Solution**: Stop Samba services first, then unmount

## Verification Steps

### 1. Check Mount Status
```bash
mount | grep sonunas
# Expected: /dev/sda2 on /sonunas type exfat (rw,relatime,uid=1001,gid=1001,fmask=0002,dmask=0002...)
```

### 2. Test File Creation
```bash
sudo -u soumyadeep touch /sonunas/test.txt
ls -la /sonunas/test.txt
# Expected: -rwxrwxr-x 1 soumyadeep soumyadeep 0 [date] test.txt
```

### 3. Verify Ownership
```bash
ls -la /sonunas/
# Expected: drwxrwxr-x soumyadeep soumyadeep [size] [date] .
```

## Next Steps
After successful mounting:
1. Configure fstab for permanent mounting
2. Update Samba configuration to use the mounted directory
3. Test access from all devices (Windows, Android, etc.)
